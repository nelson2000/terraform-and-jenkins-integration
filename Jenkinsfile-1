pipeline{
    agent any
    
    stages{
        stage("terraform init"){
            steps{
                echo "Initializing terraform"
                sh "terraform init"
            }
           
        }
        
         stage("terraform validate"){
          steps{
                echo "terraform validate"
                sh "terraform validate"
            }
           
        }
        
          stage("terraform format"){
          steps{
                echo "terraform format all config tf files"
                sh "terraform fmt"
            }
           
        }

        stage("terraform action"){
            parameters {
                choice choices: ['apply', 'destroy'], description: 'You can apply and the destroy resources, choose', name: 'action'
                }
            steps{
            
            withCredentials([<object of type com.cloudbees.jenkins.plugins.awscredentials.AmazonWebServicesCredentialsBinding>]) {
                echo "terraform carry out action ---> ${action}"
                sh "terraform ${action} --auto-approve"
                
                }
            }
           
        }

    }
  
}
